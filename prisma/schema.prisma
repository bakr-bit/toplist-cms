generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Brand {
  brandId             String   @id
  name                String
  defaultLogo         String?
  website             String?
  license             String?
  // Extended fields
  yearEstablished     Int?
  ownerOperator       String?
  languages           Json?
  availableCountries  Json?
  restrictedCountries Json?
  currencies          Json?
  paymentMethods      Json?
  withdrawalTime      String?
  minDeposit          String?
  minWithdrawal       String?
  maxWithdrawal       String?
  sportsBetting       Boolean?
  cryptoCasino        Boolean?
  vpnAllowed          Boolean?
  kycRequired         Boolean?
  gameProviders       Json?
  totalGames          Int?
  gameTypes           Json?
  exclusiveGames      String?
  supportContacts     String?
  supportHours        String?
  supportLanguages    Json?
  mobileCompatibility String?
  registrationProcess String?
  kycProcess          String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  toplistItems ToplistItem[]
  siteBrands   SiteBrand[]
}

model Site {
  siteKey   String   @id
  domain    String   @unique
  name      String
  serps     Json?
  createdAt DateTime @default(now())

  toplists   Toplist[]
  siteBrands SiteBrand[]
}

model Toplist {
  id        String   @id @default(uuid())
  siteKey   String
  slug      String
  title     String?
  columns      Json?
  columnLabels Json?
  pages        String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  site  Site          @relation(fields: [siteKey], references: [siteKey], onDelete: Cascade)
  items ToplistItem[]

  @@unique([siteKey, slug])
  @@index([siteKey])
}

model ToplistItem {
  id        String   @id @default(uuid())
  toplistId String
  brandId   String
  position  Int
  cta       String?
  reviewUrl String?
  // Per-toplist text overrides (override SiteBrand defaults)
  bonus      String?
  description String?
  terms      String?
  badgeText  String?
  badgeColor String?

  toplist Toplist @relation(fields: [toplistId], references: [id], onDelete: Cascade)
  brand   Brand   @relation(fields: [brandId], references: [brandId])

  @@unique([toplistId, position])
  @@index([toplistId])
  @@index([brandId])
}

model SiteBrand {
  siteKey   String
  brandId   String

  logo              String?
  bonus             String?
  affiliateUrl      String?
  rating            Decimal?  @db.Decimal(3, 1)
  terms             String?
  description       String?
  pros              Json?
  cons              Json?
  welcomePackage    String?
  noDepositBonus    String?
  freeSpinsOffer    String?
  wageringRequirement String?
  loyaltyProgram    String?
  promotions        String?
  features          Json?
  badgeText         String?
  badgeColor        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  site  Site  @relation(fields: [siteKey], references: [siteKey], onDelete: Cascade)
  brand Brand @relation(fields: [brandId], references: [brandId])

  @@id([siteKey, brandId])
  @@index([siteKey])
  @@index([brandId])
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  name         String?
  createdAt    DateTime @default(now())
}
